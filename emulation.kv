#:import NoTransition kivy.uix.screenmanager.NoTransition
#:import ScreenManager kivy.uix.screenmanager
#:import dba database_access

WindowManager:
    transition: NoTransition()
    HomeWindow:
    BrowseWindow:
    ManageWindow:
    GenerateUsersWindow:

<GoBackBtn@Button>
    text: "Go Back"
    on_release:
        app.root.current = "homeWin"
   # background_color: 0.3, 0.4, 0.5, 1
    size_hint: .12, .08
    pos_hint: {"x": 0, "y": 0.92}

<HomeWindow>:
    name: "homeWin"

    GridLayout:
        cols: 1

        Label:
            text: "Emulation app (Alpha v0.0.5)"
            bold: True
            italic: True
            color: 1,1,1,1


        GridLayout:
            cols: 2

            Button:
                id: browseBtn
                text: "Browse users"
                on_release:
                    app.root.current = "browseWin"

            Button:
                id: manageBtn
                text: "Manage users"
                on_release:
                    app.root.current = "manageWin"
        Button:
            id: generateUsersBtn
            text: "Generate users"
            on_release:
                app.root.current = "generateWin"

<BrowseWindow>:
    name: "browseWin"

    GoBackBtn:

    Button:
        text: "Load data"
        size_hint: .2, .08
        pos_hint: {"right": 1, "y": 0.92}
        on_release:
            root.btn_create_user_labels()

    ScrollView:
        id: scroll_content
        size_hint: (1, .92)
        bar_width: 10
        bar_color: 1, 0, 0, 1
        bar_inactive_color: 0, 0, 1, 1
        scroll_type: ['bars']
        do_scroll_y: True
        do_scroll_x: False

        StackLayout:
            id: content
            cols: 1
            spacing: 5

<ManageWindow>:
    name: "manageWin"

    GoBackBtn:

    Button:
        text: "Load data"
        size_hint: .2, .08
        pos_hint: {"right": 1, "y": 0.92}
        on_release:
            root.btn_create_user_labels()

    Button:
        text: "Delete user"
        size_hint: .2, .08
        pos_hint: {"right": 0.8, "y": 0.92}
        on_release:
            root.btn_delete_user()

    Button:
        text: "Update user data"
        size_hint: .25, .08
        pos_hint: {"right": 0.6, "y": 0.92}
        on_release:
            root.btn_update_user_data()

    ScrollView:
        id: scroll_content
        size_hint: (1, .92)
        bar_width: 10
        bar_color: 1, 0, 0, 1
        bar_inactive_color: 0, 0, 1, 1
        scroll_type: ['bars']
        do_scroll_y: True
        do_scroll_x: False

        StackLayout:
            id: content
            cols: 1
            spacing: 5

<GenerateUsersWindow>:
    name: "generateWin"

    GoBackBtn:

    Label:
        text: 'Generate users'
        size_hint: .9, .2
        pos_hint: {"x": .05, "y": .7}

    GridLayout:
        cols: 2
        size_hint: .9, .2
        pos_hint: {"x": .05, "y": .4}

        Button:
            id: append_users
            text: "Append users list"
            halign: 'center'
            valign: 'middle'
            on_release:
                root.btn_append()

        Button:
            id: delete_and_create_new_users
            text: "Clear users list\nand generate new users"
            halign: 'center'
            valign: 'middle'
            on_release:
                root.btn_clear_and_generate()

<PopCreateAppend>:
    Label:
        text: "amount: "
        size_hint: None, None
        height: 30
        width: 100
        pos_hint: {"center_x": .3, "center_y": .6}

    TextInput:
        id: amount_of_users
        size_hint: None, None
        height: 30
        width: 100
        pos_hint: {"center_x": .6, "center_y": .6}
        multiline: False

    Button:
        text: "Submit"
        size_hint: .8, .2
        pos_hint: {"center_x": .5, "center_y": .2}
        on_release:
            dba.create_users(int(amount_of_users.text))
            root.entry_done()

    Label:
        id: entry_done
        text: ''
        color: 0, 1, 0, 1
        size_hint: .8, .2
        pos_hint: {"center_x": .5, "center_y": .05}


<PopClearAndGenerate>
    Label:
        text: "amount: "
        size_hint: None, None
        height: 30
        width: 100
        pos_hint: {"center_x": .3, "center_y": .7}

    TextInput:
        id: amount_of_users
        size_hint: None, None
        height: 30
        width: 100
        pos_hint: {"center_x": .6, "center_y": .7}
        multiline: False

    Label:
        text: "password: "
        size_hint: None, None
        height: 30
        width: 100
        pos_hint: {"center_x": .3, "center_y": .5}

    TextInput:
        id: password
        password: True
        size_hint: None, None
        height: 30
        width: 100
        pos_hint: {"center_x": .6, "center_y": .5}
        multiline: False

    Button:
        text: "Submit"
        size_hint: .8, .2
        pos_hint: {"center_x": .5, "center_y": .2}
        on_release:
            if password.text == '123':\
            dba.delete_all_users();\
            dba.create_users(int(amount_of_users.text));\
            root.correct_password()
            else: root.incorrect_password()

    Label:
        id: incorrect_passwd
        text: ''
        color: 1, 0, 0, 1
        size_hint: .8, .2
        pos_hint: {"center_x": .5, "center_y": .05}

    Label:
        id: correct_passwd
        text: ''
        color: 0, 1, 0, 1
        size_hint: .8, .2
        pos_hint: {"center_x": .5, "center_y": .05}

<PopDeleteUser>:
    Label:
        text: "Index of the user: "
        size_hint: None, None
        height: 30
        width: 100
        pos_hint: {"center_x": .3, "center_y": .7}

    TextInput:
        id: user_index
        size_hint: None, None
        height: 30
        width: 100
        pos_hint: {"center_x": .6, "center_y": .7}
        multiline: False

    Label:
        text: "password: "
        size_hint: None, None
        height: 30
        width: 100
        pos_hint: {"center_x": .3, "center_y": .5}

    TextInput:
        id: password
        password: True
        size_hint: None, None
        height: 30
        width: 100
        pos_hint: {"center_x": .6, "center_y": .5}
        multiline: False

    Button:
        text: "Submit"
        size_hint: .8, .2
        pos_hint: {"center_x": .5, "center_y": .2}
        on_release:
            if password.text == '123' and str(user_index.text).isdigit() and int(user_index.text) > 0:\
            dba.delete_user((dba.get_all_users()[int(user_index.text) - 1])[dba.keys[0]]);\
            root.correct_data()
            else: root.incorrect_data()

    Label:
        id: incorrect_data
        text: ''
        color: 1, 0, 0, 1
        size_hint: .8, .2
        pos_hint: {"center_x": .5, "center_y": .05}

    Label:
        id: correct_data
        text: ''
        color: 0, 1, 0, 1
        size_hint: .8, .2
        pos_hint: {"center_x": .5, "center_y": .05}

<PopUpdateUserData>:
    Label:
        text: "Index of the user: "
        size_hint: None, None
        height: 30
        width: 100
        pos_hint: {"center_x": .3, "center_y": .9}

    TextInput:
        id: user_index
        size_hint: None, None
        height: 30
        width: 100
        pos_hint: {"center_x": .6, "center_y": .9}
        multiline: False

    Label:
        text: "password: "
        size_hint: None, None
        height: 30
        width: 100
        pos_hint: {"center_x": .3, "center_y": .8}

    TextInput:
        id: password
        password: True
        size_hint: None, None
        height: 30
        width: 100
        pos_hint: {"center_x": .6, "center_y": .8}
        multiline: False

    Label:
        text: "data type: "
        size_hint: None, None
        height: 30
        width: 100
        pos_hint: {"center_x": .3, "center_y": .7}

    Label:
        text: "separate with semicolons"
        font_size: 10
        color: 0, 1, .5, 1
        size_hint: None, None
        height: 30
        width: 100
        pos_hint: {"center_x": .3, "center_y": .65}

    TextInput:
        id: data_type
        size_hint: None, None
        height: 30
        width: 100
        pos_hint: {"center_x": .6, "center_y": .7}
        multiline: True

    Label:
        text: "new data: "
        size_hint: None, None
        height: 30
        width: 100
        pos_hint: {"center_x": .3, "center_y": .6}

    Label:
        text: "separate with semicolons"
        font_size: 10
        color: 0, 1, .5, 1
        size_hint: None, None
        height: 30
        width: 100
        pos_hint: {"center_x": .3, "center_y": .55}

    TextInput:
        id: new_data
        size_hint: None, None
        height: 30
        width: 100
        pos_hint: {"center_x": .6, "center_y": .6}
        multiline: True

    Button:
        text: "Submit"
        size_hint: .8, .2
        pos_hint: {"center_x": .5, "center_y": .2}
        on_release:
            data = root.generate_data_dict(data_type.text, new_data.text)
            if password.text == '123':\
            dba.update_user_data((dba.get_all_users()[int(user_index.text) - 1])[dba.keys[0]], data);\
            root.correct_data()
            else: root.incorrect_data()

    Label:
        id: incorrect_data
        text: ''
        color: 1, 0, 0, 1
        size_hint: .8, .2
        pos_hint: {"center_x": .5, "center_y": .05}

    Label:
        id: correct_data
        text: ''
        color: 0, 1, 0, 1
        size_hint: .8, .2
        pos_hint: {"center_x": .5, "center_y": .05}